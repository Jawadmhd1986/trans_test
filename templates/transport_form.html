<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Transportation Quotation</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <section class="quote-section">
    <img class="dsv-logo" src="{{ url_for('static', filename='dsv_logo.png') }}" alt="DSV" />

    <form id="transport-form" class="quote-card" method="POST" action="/generate_transport">
      <h1>Transportation Quotation</h1>

      <!-- Route groups holder -->
      <div id="route-groups" class="route-groups">
        <!-- ===== Route Group Template (index 0) ===== -->
        <div class="route-group" data-index="0">
          <div class="route-header">
            <span>Route <b>#1</b></span>
          </div>

          <div class="row two">
            <div class="field">
              <label for="origin_0">From</label>
              <select id="origin_0" name="origin_0" required>
                {% for o in origins %}
                <option value="{{ o }}">{{ o }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="field">
              <label for="destination_0">To</label>
              <select id="destination_0" name="destination_0" required>
                {% for d in destinations %}
                <option value="{{ d }}">{{ d }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="group-box">
            <div class="group-title">Trip Type</div>
            <div class="btn-toggle">
              <input type="radio" id="one_way_0" name="trip_type_0" value="one_way" checked>
              <label for="one_way_0">One Way</label>
              <input type="radio" id="back_load_0" name="trip_type_0" value="back_load">
              <label for="back_load_0">Back Load</label>
            </div>

            <!-- Trucks list for this route -->
            <div class="truck-rows" data-index="0">
              <div class="row three truck-row">
                <div class="field">
                  <label>Type</label>
                  <select name="truck_type_0[]" class="truck-type">
                    {% for t in truck_types %}
                    <option value="{{ t }}">{{ t }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="field sm">
                  <label>QTY</label>
                  <input type="number" name="truck_qty_0[]" class="truck-qty" value="1" min="1">
                </div>

                <div class="field">
                  <label>Trip</label>
                  <select name="trip_kind_0[]" class="trip-kind">
                    <option value="">Use Main Trip</option>
                    <option value="one_way">One Way</option>
                    <option value="back_load">Back Load</option>
                  </select>
                </div>

                <button type="button" class="clear-row" title="Remove row">✕</button>
              </div>
            </div>

            <button type="button" class="btn-secondary add-truck" data-index="0">+ Add Truck Type</button>
          </div>

          <div class="field">
            <label for="cargo_type_0">Cargo Type</label>
            <select id="cargo_type_0" name="cargo_type_0">
              <option value="general" selected>General Cargo</option>
              <option value="chemical">Chemical Load</option>
            </select>
          </div>
        </div>
        <!-- ===== End Group 0 ===== -->
      </div>

      <!-- Tracks how many route groups exist -->
      <input type="hidden" id="groups_count" name="groups_count" value="1"/>

      <!-- Add another From/To (Route) -->
      <button type="button" id="add-route" class="btn-secondary full">+ Add From / To</button>

      <button type="submit" class="btn-primary full">Generate</button>
    </form>

    <!-- Chat UI -->
    <button class="chat-toggle" type="button" aria-label="Open chat">
      <img src="{{ url_for('static', filename='chat-icon.png') }}" alt="chat">
    </button>
    <div class="chat-window" id="chatWin" aria-live="polite">
      <div class="chat-header">
        <div class="chat-title"><span class="logo"></span><span>DSV Chat</span></div>
        <button id="chat-close" type="button" title="Close">✕</button>
      </div>
      <div class="chat-body" id="chat-box"></div>
      <div class="chat-footer">
        <input id="chat-input" type="text" placeholder="Type a message..." />
        <button id="chat-send" type="button">Send</button>
      </div>
    </div>
  </section>

  <script>
    window.__CICPA_CITIES__ = {{ cicpa_cities|tojson }};
    window.__LOCAL_TRUCKS__ = {{ local_trucks|tojson }};
    window.__CICPA_TRUCKS__ = {{ cicpa_trucks|tojson }};
  </script>
  <script src="{{ url_for('static', filename='chatbot.js') }}"></script>
</body>
</html>
